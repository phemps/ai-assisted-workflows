# syntax=docker/dockerfile:1
# Minimal Alpine base image for CLI evaluation
FROM alpine:3.19 AS base

# Install only essential tools
RUN apk add --no-cache \
    curl wget git bash \
    python3 py3-pip \
    nodejs npm \
    ca-certificates \
    && rm -rf /var/cache/apk/*

# Create non-root user with specific UID/GID for consistency
RUN addgroup -g 1001 evaluator && \
    adduser -u 1001 -G evaluator -D -s /bin/bash evaluator

# Setup secure directories
RUN mkdir -p /home/evaluator/workspace /home/evaluator/.cache && \
    chown -R evaluator:evaluator /home/evaluator

USER evaluator
WORKDIR /home/evaluator/workspace

# Set up environment
ENV PATH="/home/evaluator/.local/bin:$PATH"
ENV PYTHONPATH="/home/evaluator/.local/lib/python3.11/site-packages:$PYTHONPATH"

# Install common Python packages as evaluator user
RUN pip3 install --user --no-cache-dir --break-system-packages \
    pyyaml requests

# Default command to keep container running
CMD ["sleep", "infinity"]
